<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CC Rationale Metadata Generator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>CC Rationale Metadata Generator</h1>
    <form id="metadata-form" onsubmit="return false;">

        <div class="step" id="step-1">
            <h2>Step 1: Basic Information <span class="step-status" id="status-step-1"></span></h2>
            <div class="form-group">
                <label for="hashAlgorithm">Hash Algorithm:</label>
                <input type="text" id="hashAlgorithm" placeholder="e.g., blake2b-256" value="blake2b-256" required>
                <small>Hashing algorithm used (e.g., blake2b-256).</small>
            </div>
            <div class="form-group">
                <label for="subject">Subject:</label>
                <input type="text" id="subject" placeholder="e.g., Rationale for Vote on GovAction XYZ-123">
                <small>A concise title or subject (Optional, not in final JSON structure).</small>
            </div>
            <div class="form-group">
                <label for="authors">Author(s):</label>
                <textarea id="authors" rows="3" placeholder="Enter one author name per line or separate by semicolons. E.g., Org Name; Individual Name" required></textarea>
                 <small>Name of the CC member(s) authoring this rationale. Required.</small>
            </div>
            <div class="navigation-buttons">
                <button type="button" onclick="nextStep()">Next</button>
            </div>
        </div>

        <div class="step" id="step-2" style="display: none;">
             <h2>Step 2: Core Rationale (Compulsory) <span class="step-status" id="status-step-2"></span></h2>
            <div class="form-group">
                <label for="summary">Summary:</label>
                <textarea id="summary" rows="4" maxlength="300" required></textarea>
                <small>Short statement (Max 300 chars). <span id="summary-char-count">0</span>/300</small>
            </div>
            <div class="form-group">
                <label for="rationaleStatement">Rationale Statement:</label>
                <textarea id="rationaleStatement" rows="10" required></textarea>
                <small>Full rationale. Markdown supported.</small>
            </div>
            <div class="navigation-buttons">
                <button type="button" onclick="prevStep()">Previous</button>
                <button type="button" onclick="nextStep()">Next</button>
            </div>
        </div>

        <div class="step" id="step-3" style="display: none;">
             <h2>Step 3: Supporting Discussion (Optional) <span class="step-status" id="status-step-3"></span></h2>
            <div class="form-group">
                <label for="precedentDiscussion">Precedent Discussion:</label>
                <textarea id="precedentDiscussion" rows="6"></textarea>
                <small>Discuss relevant precedent. Markdown supported.</small>
            </div>
            <div class="form-group">
                <label for="counterargumentDiscussion">Counterargument Discussion:</label>
                <textarea id="counterargumentDiscussion" rows="6"></textarea>
                <small>Discuss significant counterarguments. Markdown supported.</small>
            </div>
            <div class="form-group">
                <label for="conclusion">Conclusion:</label>
                <textarea id="conclusion" rows="4"></textarea>
                <small>Concluding remarks. Markdown NOT supported.</small>
            </div>
            <div class="navigation-buttons">
                <button type="button" onclick="prevStep()">Previous</button>
                <button type="button" onclick="nextStep()">Next</button>
            </div>
        </div>

        <div class="step" id="step-4" style="display: none;">
             <h2>Step 4: Internal Voting (Optional) <span class="step-status" id="status-step-4"></span></h2>
            <p>If this CC member represents an organization/consortium with internal voting, provide the breakdown below.</p>
            <div class="form-group-inline">
                <label for="internal_constitutional_votes">Constitutional Votes:</label>
                <input type="number" id="internal_constitutional_votes" min="0" step="1">
            </div>
            <div class="form-group-inline">
                <label for="internal_unconstitutional_votes">Unconstitutional Votes:</label>
                <input type="number" id="internal_unconstitutional_votes" min="0" step="1">
            </div>
            <div class="form-group-inline">
                <label for="internal_abstain_votes">Abstain Votes:</label>
                <input type="number" id="internal_abstain_votes" min="0" step="1">
            </div>
            <div class="form-group-inline">
                <label for="internal_did_not_vote">Did Not Vote:</label>
                <input type="number" id="internal_did_not_vote" min="0" step="1">
            </div>
            <div class="form-group-inline">
                <label for="internal_against_vote">Votes Against Voting:</label>
                <input type="number" id="internal_against_vote" min="0" step="1">
                <small style="margin-left: 10px; width: auto;">(Note: This field is not part of the standard reference JSON structure)</small>
            </div>
            <div class="navigation-buttons">
                <button type="button" onclick="prevStep()">Previous</button>
                <button type="button" onclick="nextStep()">Next</button>
            </div>
        </div>

        <div class="step" id="step-5" style="display: none;">
             <h2>Step 5: References <span class="step-status" id="status-step-5"></span></h2>

             <div class="reference-library">
                <h3>Reference Library</h3>
                <div class="form-group">
                    <label for="library-select">Select a common reference:</label>
                    <select id="library-select" class="form-control">
                        <option value="">-- Select --</option>
                        </select>
                </div>
                <div class="library-buttons">
                    <button type="button" class="library-add-button" onclick="addLibraryReference('relevant')">Add to Relevant Articles</button>
                    <button type="button" class="library-add-button" onclick="addLibraryReference('other')">Add to Other References</button>
                </div>
            </div>

            <div class="manual-reference-adder">
                <h3>Add Manual Reference</h3>
                <div class="form-group">
                    <label for="manualRefLabel">Reference Label:</label>
                    <input type="text" id="manualRefLabel" placeholder="e.g., Constitution Article III">
                </div>
                <div class="form-group">
                    <label for="manualRefUri">Reference URI:</label>
                    <input type="text" id="manualRefUri" placeholder="e.g., cardano:constitution:article-III or https://...">
                </div>
                <div class="form-group">
                     <label for="manualRefTarget">Add to:</label>
                     <select id="manualRefTarget">
                         <option value="relevant">Relevant Constitution Articles</option>
                         <option value="other">Other References</option>
                     </select>
                </div>
                <button type="button" class="manual-add-button" onclick="addManualReference()">Add Manual Reference</button>
                <div id="manual-ref-error" class="manual-ref-message error" style="display: none;"></div>
            </div>

            <div class="references-display-area">
                <h4>Added Relevant Articles:</h4>
                <ul id="relevantArticlesDisplay" class="references-list">
                    </ul>

                <div id="constitution-articles-selector" style="display: none;" class="form-group constitution-selector">
                    <label>Select Relevant Constitution Sections/Articles:</label>
                    <div id="constitution-checkboxes-container">
                        </div>
                    <small>Select all applicable sections for the rationale.</small>
                </div>
                <h4>Added Other References:</h4>
                <ul id="otherReferencesDisplay" class="references-list">
                     </ul>
            </div>

            <p style="margin-top: 20px;">
                Want to add to the reference library? Please submit a pull request on GitHub:
                <a href="https://github.com/Thomas-nada/Council-rationale-generator" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                    https://github.com/Thomas-nada/Council-rationale-generator
                </a>
            </p>

            <div class="navigation-buttons">
                <button type="button" onclick="prevStep()">Previous</button>
                <button type="button" onclick="nextStep()">Next</button>
            </div>
        </div>
        <div class="step" id="step-6" style="display: none;">
             <h2>Step 6: Review and Generate</h2>
            <p>Please review the information below. Go back to previous steps to make changes if necessary. Click "Verify Metadata" to check for required fields before generating the file.</p>
            <div id="review-area">
                </div>
            <div id="verification-status" style="margin-top: 15px;"></div>
            <div class="navigation-buttons">
                <button type="button" onclick="prevStep()">Previous</button>
                <button type="button" id="verify-button" onclick="verifyMetadata()">Verify Metadata</button>
                <button type="button" id="generate-button" onclick="generateJson()" disabled>Generate JSON File</button>
            </div>
            <div id="error-message" class="error" style="display: none;"></div>
        </div>

    </form>

    <script src="script.js"></script>
</body>
</html>
